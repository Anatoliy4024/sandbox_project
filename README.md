# TelegramBot_PicnicAlicante

## Версия от 09.09.2024

### 1. Описание проекта
Проект **TelegramBot_PicnicAlicante** предназначен для автоматического администрирования и организации ивентов. Пользователи взаимодействуют с ботом в Telegram, выбирая дату, время, количество участников, стиль мероприятия и другие параметры. В результате формируется заказ с возможностью расчета стоимости и бронирования.

### 2. Файловая структура проекта

- **`main.py`**: Основной файл проекта, запускающий бота и обрабатывающий пользовательские запросы.
- **`database_logger.py`**: Модуль, отвечающий за логирование операций с базой данных.
- **`abstract_functions.py`**: Набор вспомогательных функций для работы с базой данных и повторных попыток выполнения запросов.
- **`keyboards.py`**: Модуль, создающий различные клавиатуры для взаимодействия с пользователем.
- **`view_database.py`**: Модуль для отображения и анализа данных из базы данных.
- **`sqlite.db`**: Файл базы данных SQLite, где хранятся сессии и заказы пользователей.
- **`message_handlers.py`**: Модуль, обрабатывающий сообщения и команды, отправляемые пользователями.
- **`media/`**: Директория с медиафайлами, включая видеоролики для приветствия.
- **`constants.py`**: Модуль, содержащий ключевые константы и временные данные, используемые в проекте.
- **`initialize_db.py`**: Скрипт для инициализации и настройки базы данных с необходимыми таблицами.
- **`main_sandbox.py`**: Песочница для тестирования новых функций и логики бота.
- **`check_db_structure.py`**: Скрипт для проверки корректности структуры базы данных.
- **`button_template.py`**: Шаблон для создания кнопок, используемых в интерфейсе бота.
- **`order_calculation.py`**: Модуль для расчета стоимости мероприятий на основе данных заказа.
- **`bank_payment.py`**: Модуль, эмулирующий процесс оплаты и переход к проформе после внесения предоплаты.
- **`confirmation_buttons.py`**: Модуль, генерирующий кнопки подтверждения действий на разных этапах работы бота.
- **`proforma_generator.py`**: Модуль для создания проформы на основе данных заказа и предоставления возможности сохранить её.
- **`final_confirmation_buttons.py`**: Планируемый модуль для генерации финальных кнопок подтверждения действий.

### 3. Архитектура

#### 3.1 Принцип каскадности
В проекте используется принцип каскадности, который разделяет модули на **переменные** и **постоянные** абстракции:
- **Переменные абстракции** — это модули, которые учитывают предпочтения пользователей, позволяя выбирать различные опции (например, язык, дата, время).
- **Постоянные абстракции** — это модули, выполняющие однотипные задачи, такие как запросы подтверждения, приветствия или ввод имени, а также кнопки "Да" и "Нет".

На момент создания документации (20.08.2024) проект включает:
- Переменных абстракций: **9**
- Постоянных абстракций: **8**

#### 3.2 Перечень модулей и их функций

1. **`language_selection`** (переменный) — выбор языка.
   - Функция: `language_selection_keyboard()`

2. **`greeting`** (постоянный) — приветствие и запрос имени.
   - Функция: `handle_name()`

3. **`date_selection`** (переменный) — выбор даты мероприятия.
   - Функции: `generate_calendar_keyboard()`, `show_calendar()`

4. **`date_confirmation`** (постоянный) — подтверждение даты.
   - Функция: `disable_calendar_buttons()`

5. **`time_selection`** (переменный) — выбор времени мероприятия.
   - Функция: `generate_time_selection_keyboard()`

6. **`time_confirmation`** (постоянный) — подтверждение времени.
   - Функция: `disable_time_buttons()`

7. **`people_selection`** (переменный) — выбор количества участников.
   - Функция: `generate_person_selection_keyboard()`

8. **`people_confirmation`** (постоянный) — подтверждение количества участников.
   - Функция: `disable_person_buttons()`

9. **`style_selection`** (переменный) — выбор стиля мероприятия.
   - Функция: `generate_party_styles_keyboard()`

10. **`style_confirmation`** (постоянный) — подтверждение выбранного стиля.
    - Функция: `disable_style_buttons()`

11. **`preferences_request`** (переменный) — запрос предпочтений пользователя.
    - Функция: `handle_preferences()`

12. **`city_request`** (переменный) — запрос города для проведения мероприятия.
    - Функция: `handle_city()`

13. **`order_calculation`** (переменный) — формирование заказа и расчёт стоимости мероприятия.
    - Функция: `calculate_order_cost()`

14. **`bank_payment`** (переменный) — имитация процесса оплаты и переход к проформе.
    - Функция: `show_payment_page()`

15. **`confirmation_buttons`** (постоянный) — генерация кнопок "Да/Нет" для подтверждения действий.
    - Функция: `generate_confirmation_buttons()`

16. **`proforma_generator`** (переменный) — генерация проформы и возможность её сохранения.
    - Функции: `generate_proforma()`, `save_proforma()`

17. **`final_confirmation_buttons`** (постоянный) — генерация финальных кнопок для завершения или продолжения работы бота.
    - Функция: `generate_final_confirmation_buttons()`

#### 3.3 Принцип взаимодействия файлов
Модули взаимодействуют друг с другом на разных этапах работы бота. Основной файл **`main.py`** инициализирует бота и управляет обработкой всех взаимодействий, в то время как другие модули отвечают за более узкие задачи (например, расчёт стоимости или создание кнопок).

1. **`main.py`** — основной файл, ответственный за обработку взаимодействий с пользователями.
   - Настройки Telegram API.
   - Логирование операций в файл.
   - Асинхронные обработчики команд, таких как `/start`.
   - Взаимодействие с пользователем через кнопки и клавиатуры.

2. **`database_logger.py`** — модуль для логирования операций с базой данных.
   - Функции логирования SQL-запросов и их выполнения.
   - Логирование успешных или неудачных попыток взаимодействия с базой данных.

3. **`abstract_functions.py`** — вспомогательные функции для работы с базой данных.
   - Создание соединений и выполнение SQL-запросов с учётом повторных попыток в случае ошибок.
   - Логирование операций с базой данных.

4. **`keyboards.py`** — создание клавиатур для взаимодействия с пользователем.
   - Генерация клавиатур для выбора даты, времени, количества участников и других параметров мероприятия.
   - Создание кнопок "Да/Нет" для подтверждения.

5. **`view_database.py`** — модуль для просмотра данных из базы данных.
   - Получение и вывод данных о пользователях или заказах из базы данных.

### 4. Нововведения версии 5.0

#### 4.1 Новые модули

1. **`initialize_db.py`** — инициализация базы данных.
   - Назначение: создание таблиц пользователей и заказов при первом запуске.

2. **`main_sandbox.py`** — песочница для тестирования функций.
   - Назначение: безопасное тестирование новых функций без влияния на основную работу бота.

3. **`button_template.py`** — шаблон для создания кнопок.
   - Назначение: генерация кнопок для интерфейса Telegram-бота.

4. **`order_calculation.py`** — расчёт стоимости заказа.
   - Назначение: расчёт общей стоимости мероприятия на основе введённых данных.

5. **`bank_payment.py`** — модуль для имитации процесса оплаты.
   - Назначение: имитация оплаты и переход к созданию проформы.

6. **`proforma_generator.py`** — генерация и сохранение проформы.
   - Назначение: создание проформы на основе данных заказа с возможностью её сохранения.

7. **`final_confirmation_buttons.py`** — финальная генерация кнопок подтверждения.
   - Назначение: завершение работы бота или перенаправление на другие действия.

### 5. Примечания

- В новой версии 5.0 добавлены и переработаны модули, такие как обработка платежей и создание проформ.
- Улучшена структура работы с языковыми предпочтениями пользователей, оптимизированы функции для взаимодействия с базой данных.
- Структура логирования и обработки ошибок значительно улучшена для упрощения отладки и мониторинга работы бота.
